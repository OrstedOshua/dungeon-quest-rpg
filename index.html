<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öîÔ∏è Dungeon Quest RPG</title>
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #0f3460;
            --text-primary: #e4e4e4;
            --text-secondary: #a0a0a0;
            --accent-primary: #e94560;
            --accent-secondary: #533483;
            --border-color: #2d3748;
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .hidden {
            display: none !important;
        }

        /* Login Screen */
        #loginScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
        }

        .login-box {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            min-width: 350px;
            animation: fadeIn 0.5s ease-out;
        }

        .login-box h1 {
            color: var(--accent-primary);
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .btn {
            padding: 12px 30px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
        }

        .btn:hover:not(:disabled) {
            background: #c73851;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(233, 69, 96, 0.4);
        }

        .btn:disabled {
            background: var(--border-color);
            cursor: not-allowed;
            transform: none;
            opacity: 0.6;
        }

        .btn-secondary {
            background: var(--accent-secondary);
            box-shadow: 0 4px 15px rgba(83, 52, 131, 0.3);
        }

        .btn-secondary:hover:not(:disabled) {
            background: #422a69;
        }

        .btn-success {
            background: var(--success);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.3);
        }

        .btn-success:hover:not(:disabled) {
            background: #38a169;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        /* Game Screen */
        #gameScreen {
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            gap: 20px;
            margin-top: 20px;
        }

        /* Card Styles */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.5s ease-out;
        }

        .card h2 {
            color: var(--accent-primary);
            margin-bottom: 15px;
            font-size: 1.5em;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        /* Character Info */
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: var(--bg-secondary);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .stat-value {
            color: var(--accent-primary);
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            margin: 8px 0;
            border: 1px solid var(--border-color);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .progress-fill.hp-bar {
            background: linear-gradient(90deg, #e94560, #c73851);
        }

        .progress-fill.exp-bar {
            background: linear-gradient(90deg, #48bb78, #38a169);
        }

        /* Equipment */
        .equipment-slot {
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent-primary);
        }

        .equipment-slot strong {
            color: var(--accent-secondary);
            display: block;
            margin-bottom: 5px;
        }

        /* Combat Area */
        .combat-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .monster-display {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid var(--danger);
            text-align: center;
        }

        .monster-display h3 {
            color: var(--danger);
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(245, 101, 101, 0.5);
        }

        .combat-log {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            border-left: 3px solid var(--accent-primary);
            padding-left: 10px;
            font-size: 14px;
            animation: slideIn 0.3s ease-out;
        }

        .reward-display {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            border: 2px solid var(--success);
        }

        .reward-display h3 {
            color: var(--success);
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .reward-item {
            padding: 10px;
            background: var(--bg-card);
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid var(--success);
        }

        /* Shop */
        .shop-items, .quest-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 500px;
            overflow-y: auto;
        }

        .shop-item, .quest-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 3px solid var(--accent-primary);
            transition: transform 0.2s;
        }

        .shop-item:hover {
            transform: translateX(5px);
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            color: var(--accent-primary);
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .item-stats {
            color: var(--text-secondary);
            font-size: 13px;
            margin-bottom: 3px;
        }

        .item-price {
            color: var(--warning);
            font-weight: bold;
            margin-right: 10px;
            font-size: 16px;
        }

        /* Quests */
        .quest-item {
            border-left-color: var(--accent-primary);
            flex-direction: column;
            align-items: flex-start;
        }

        .quest-item.completed {
            border-left-color: var(--success);
            opacity: 0.7;
        }

        .quest-title {
            color: var(--accent-primary);
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .quest-desc {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .quest-reward {
            color: var(--warning);
            font-size: 13px;
        }

        /* Inventory */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
        }

        .inventory-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid var(--border-color);
            transition: all 0.2s;
            cursor: pointer;
        }

        .inventory-item:hover {
            transform: scale(1.05);
            border-color: var(--accent-primary);
        }

        .item-count {
            background: var(--accent-primary);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-top: 5px;
            display: inline-block;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #c73851;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            #gameScreen {
                grid-template-columns: 1fr;
            }
        }

        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            padding: 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="container">
        <div class="login-box">
            <h1>‚öîÔ∏è Dungeon Quest ‚öîÔ∏è</h1>
            <div class="input-group">
                <input type="text" id="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" maxlength="20">
            </div>
            <button class="btn" onclick="login()">–ù–∞—á–∞—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="container hidden">
        <!-- Left Panel: Character Info -->
        <div>
            <div class="card">
                <h2>üë§ –ü–µ—Ä—Å–æ–Ω–∞–∂</h2>
                <div class="stat-row">
                    <span class="stat-label">–ò–º—è:</span>
                    <span class="stat-value" id="playerName">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–£—Ä–æ–≤–µ–Ω—å:</span>
                    <span class="stat-value" id="playerLevel">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–ó–æ–ª–æ—Ç–æ:</span>
                    <span class="stat-value">üí∞ <span id="playerGold">-</span></span>
                </div>
                
                <div style="margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>‚ù§Ô∏è HP:</span>
                        <span id="playerHpText">-</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill hp-bar" id="hpBar" style="width: 100%;">-</div>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>‚≠ê –û–ø—ã—Ç:</span>
                        <span id="playerExpText">-</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill exp-bar" id="expBar" style="width: 0%;">-</div>
                    </div>
                </div>
                
                <div class="stat-row" style="margin-top: 15px;">
                    <span class="stat-label">‚öîÔ∏è –°–∏–ª–∞:</span>
                    <span class="stat-value" id="playerStrength">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">üõ°Ô∏è –ó–∞—â–∏—Ç–∞:</span>
                    <span class="stat-value" id="playerDefense">-</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">‚ö° –õ–æ–≤–∫–æ—Å—Ç—å:</span>
                    <span class="stat-value" id="playerAgility">-</span>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h2>üé≤ –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</h2>
                <div class="equipment-slot">
                    <strong>‚öîÔ∏è –û—Ä—É–∂–∏–µ:</strong>
                    <div id="equippedWeapon">-</div>
                </div>
                <div class="equipment-slot">
                    <strong>üõ°Ô∏è –ë—Ä–æ–Ω—è:</strong>
                    <div id="equippedArmor">-</div>
                </div>
                <div class="equipment-slot">
                    <strong>üíç –ê–∫—Å–µ—Å—Å—É–∞—Ä:</strong>
                    <div id="equippedAccessory">-</div>
                </div>
            </div>
        </div>

        <!-- Center Panel: Combat/Main Area -->
        <div>
            <div class="card">
                <h2>‚öîÔ∏è –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</h2>
                
                <div class="combat-buttons">
                    <button class="btn btn-success" onclick="startCombat()">üó°Ô∏è –ò—Å–∫–∞—Ç—å –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞</button>
                    <button class="btn btn-secondary" onclick="healPlayer()">‚ù§Ô∏è –õ–µ—á–∏—Ç—å—Å—è (20 üí∞)</button>
                </div>
                
                <div id="combatArea" class="hidden" style="margin-top: 20px;">
                    <div class="monster-display">
                        <h3 id="monsterName">-</h3>
                        <div style="color: var(--text-secondary); margin-bottom: 10px;">
                            –£—Ä–æ–≤–µ–Ω—å <span id="monsterLevel">-</span> | 
                            ‚öîÔ∏è <span id="monsterStrength">-</span> | 
                            üõ°Ô∏è <span id="monsterDefense">-</span>
                        </div>
                        <div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span>HP:</span>
                                <span id="monsterHpText">-</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="monsterHpBar" style="width: 100%; background: linear-gradient(90deg, #f56565, #c73851);">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="combat-log" id="combatLog"></div>
                    
                    <div class="combat-buttons">
                        <button class="btn" onclick="attack()">‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-secondary" onclick="fleeCombat()">üèÉ –°–±–µ–∂–∞—Ç—å</button>
                    </div>
                    
                    <div id="rewardDisplay" class="reward-display hidden"></div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h2>üìú –ö–≤–µ—Å—Ç—ã</h2>
                <div id="questList" class="quest-list"></div>
            </div>
        </div>

        <!-- Right Panel: Shop & Inventory -->
        <div>
            <div class="card">
                <h2>üè™ –ú–∞–≥–∞–∑–∏–Ω</h2>
                <div id="shopItems" class="shop-items"></div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
                <div id="inventoryItems" class="inventory-grid"></div>
            </div>
        </div>
    </div>

    <script>
        // Game Data
        const ITEMS = [
            {name: '–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –º–µ—á', type: 'weapon', damage: 5, price: 0, level: 1, desc: '–ë–∞–∑–æ–≤–æ–µ –æ—Ä—É–∂–∏–µ'},
            {name: '–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á', type: 'weapon', damage: 15, price: 50, level: 3, desc: '–ü—Ä–æ—á–Ω—ã–π –∂–µ–ª–µ–∑–Ω—ã–π –∫–ª–∏–Ω–æ–∫'},
            {name: '–°—Ç–∞–ª—å–Ω–æ–π –∫–ª–∏–Ω–æ–∫', type: 'weapon', damage: 25, price: 150, level: 5, desc: '–û—Å—Ç—Ä–æ–µ —Å—Ç–∞–ª—å–Ω–æ–µ –æ—Ä—É–∂–∏–µ'},
            {name: '–î—Ä–∞–∫–æ–Ω–æ–±–æ–µ—Ü', type: 'weapon', damage: 50, price: 500, level: 10, desc: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –º–µ—á'},
            
            {name: '–¢–∫–∞–Ω–µ–≤–∞—è –±—Ä–æ–Ω—è', type: 'armor', defense: 3, price: 0, level: 1, desc: '–ü—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞'},
            {name: '–ö–æ–∂–∞–Ω–∞—è –±—Ä–æ–Ω—è', type: 'armor', defense: 8, price: 40, level: 2, desc: '–õ–µ–≥–∫–∞—è –∫–æ–∂–∞–Ω–∞—è –∑–∞—â–∏—Ç–∞'},
            {name: '–ñ–µ–ª–µ–∑–Ω–∞—è –±—Ä–æ–Ω—è', type: 'armor', defense: 15, price: 120, level: 5, desc: '–¢—è–∂–µ–ª–∞—è –∂–µ–ª–µ–∑–Ω–∞—è –∑–∞—â–∏—Ç–∞'},
            {name: '–î—Ä–∞–∫–æ–Ω—å—è —á–µ—à—É—è', type: 'armor', defense: 30, price: 600, level: 12, desc: '–ë—Ä–æ–Ω—è –∏–∑ —á–µ—à—É–∏ –¥—Ä–∞–∫–æ–Ω–∞'},
            
            {name: '–ö–æ–ª—å—Ü–æ —Å–∏–ª—ã', type: 'accessory', damage: 5, price: 100, level: 3, desc: '+5 –°–∏–ª—ã'},
            {name: '–ê–º—É–ª–µ—Ç –∑–∞—â–∏—Ç—ã', type: 'accessory', defense: 5, price: 100, level: 3, desc: '+5 –ó–∞—â–∏—Ç—ã'},
            {name: '–°–∞–ø–æ–≥–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏', type: 'accessory', agility: 5, price: 100, level: 3, desc: '+5 –õ–æ–≤–∫–æ—Å—Ç–∏'},
            {name: '–ö—É–ª–æ–Ω –∑–¥–æ—Ä–æ–≤—å—è', type: 'accessory', hp: 50, price: 150, level: 5, desc: '+50 –ú–∞–∫—Å. HP'},
            
            {name: '–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è', type: 'consumable', heal: 50, price: 20, level: 1, desc: '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 50 HP'},
            {name: '–ë–æ–ª—å—à–æ–µ –∑–µ–ª—å–µ', type: 'consumable', heal: 150, price: 50, level: 5, desc: '–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 150 HP'}
        ];

        const MONSTERS = [
            {name: '–°–ª–∏–∑–µ–Ω—å', level: 1, hp: 30, strength: 5, defense: 2, exp: 15, gold: 10, loot: {'–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è': 0.3}},
            {name: '–ì–∏–≥–∞–Ω—Ç—Å–∫–∞—è –∫—Ä—ã—Å–∞', level: 2, hp: 50, strength: 8, defense: 3, exp: 25, gold: 15, loot: {'–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è': 0.4}},
            {name: '–ì–æ–±–ª–∏–Ω', level: 3, hp: 70, strength: 12, defense: 5, exp: 40, gold: 25, loot: {'–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è': 0.3, '–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á': 0.1}},
            {name: '–í–æ–ª–∫', level: 4, hp: 90, strength: 15, defense: 6, exp: 60, gold: 35, loot: {'–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è': 0.5, '–ö–æ–∂–∞–Ω–∞—è –±—Ä–æ–Ω—è': 0.1}},
            {name: '–û—Ä–∫', level: 6, hp: 120, strength: 20, defense: 8, exp: 100, gold: 50, loot: {'–ë–æ–ª—å—à–æ–µ –∑–µ–ª—å–µ': 0.3, '–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á': 0.15}},
            {name: '–¢–µ–º–Ω—ã–π —Ä—ã—Ü–∞—Ä—å', level: 8, hp: 180, strength: 30, defense: 12, exp: 200, gold: 80, loot: {'–ë–æ–ª—å—à–æ–µ –∑–µ–ª—å–µ': 0.4, '–°—Ç–∞–ª—å–Ω–æ–π –∫–ª–∏–Ω–æ–∫': 0.1}},
            {name: '–¢—Ä–æ–ª–ª—å', level: 10, hp: 250, strength: 40, defense: 15, exp: 350, gold: 120, loot: {'–ë–æ–ª—å—à–æ–µ –∑–µ–ª—å–µ': 0.5, '–ñ–µ–ª–µ–∑–Ω–∞—è –±—Ä–æ–Ω—è': 0.15}},
            {name: '–î—Ä–∞–∫–æ–Ω', level: 15, hp: 500, strength: 60, defense: 20, exp: 800, gold: 300, loot: {'–î—Ä–∞–∫–æ–Ω–æ–±–æ–µ—Ü': 0.05, '–î—Ä–∞–∫–æ–Ω—å—è —á–µ—à—É—è': 0.1, '–ë–æ–ª—å—à–æ–µ –∑–µ–ª—å–µ': 0.8}}
        ];

        const QUESTS = [
            {id: 1, title: '–ü–µ—Ä–≤–∞—è –æ—Ö–æ—Ç–∞', desc: '–ü–æ–±–µ–¥–∏—Ç–µ 3 —Å–ª–∏–∑–Ω–µ–π', level: 1, target: '–°–ª–∏–∑–µ–Ω—å', count: 3, exp: 50, gold: 30, item: '–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è'},
            {id: 2, title: '–ö—Ä—ã—Å–∏–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞', desc: '–û—á–∏—Å—Ç–∏—Ç–µ –ø–æ–¥–≤–∞–ª –æ—Ç 5 –∫—Ä—ã—Å', level: 2, target: '–ì–∏–≥–∞–Ω—Ç—Å–∫–∞—è –∫—Ä—ã—Å–∞', count: 5, exp: 100, gold: 50},
            {id: 3, title: '–ì–æ–±–ª–∏–Ω—Å–∫–∞—è —É–≥—Ä–æ–∑–∞', desc: '–ü–æ–±–µ–¥–∏—Ç–µ 4 –≥–æ–±–ª–∏–Ω–æ–≤', level: 3, target: '–ì–æ–±–ª–∏–Ω', count: 4, exp: 150, gold: 80, item: '–ñ–µ–ª–µ–∑–Ω—ã–π –º–µ—á'},
            {id: 4, title: '–û—Ö–æ—Ç–∞ –Ω–∞ –≤–æ–ª–∫–æ–≤', desc: '–ü–æ–±–µ–¥–∏—Ç–µ 3 –≤–æ–ª–∫–æ–≤', level: 4, target: '–í–æ–ª–∫', count: 3, exp: 200, gold: 100, item: '–ö–æ–∂–∞–Ω–∞—è –±—Ä–æ–Ω—è'},
            {id: 5, title: '–ù–∞–±–µ–≥ –æ—Ä–∫–æ–≤', desc: '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ—Ä–∫–æ–≤ (5 –æ—Ä–∫–æ–≤)', level: 6, target: '–û—Ä–∫', count: 5, exp: 400, gold: 200, item: '–ö–æ–ª—å—Ü–æ —Å–∏–ª—ã'},
            {id: 6, title: '–¢–µ–º–Ω–∞—è –±–∞—à–Ω—è', desc: '–ü–æ–±–µ–¥–∏—Ç–µ —Ç–µ–º–Ω–æ–≥–æ —Ä—ã—Ü–∞—Ä—è', level: 8, target: '–¢–µ–º–Ω—ã–π —Ä—ã—Ü–∞—Ä—å', count: 1, exp: 600, gold: 300, item: '–°—Ç–∞–ª—å–Ω–æ–π –∫–ª–∏–Ω–æ–∫'},
            {id: 7, title: '–õ–æ–≥–æ–≤–æ —Ç—Ä–æ–ª–ª—è', desc: '–ó–∞—á–∏—Å—Ç–∏—Ç–µ –ø–µ—â–µ—Ä—É (2 —Ç—Ä–æ–ª–ª—è)', level: 10, target: '–¢—Ä–æ–ª–ª—å', count: 2, exp: 1000, gold: 500, item: '–ñ–µ–ª–µ–∑–Ω–∞—è –±—Ä–æ–Ω—è'},
            {id: 8, title: '–£–±–∏–π—Ü–∞ –¥—Ä–∞–∫–æ–Ω–æ–≤', desc: '–ü–æ–±–µ–¥–∏—Ç–µ –¥—Ä–∞–∫–æ–Ω–∞', level: 15, target: '–î—Ä–∞–∫–æ–Ω', count: 1, exp: 2000, gold: 1000, item: '–î—Ä–∞–∫–æ–Ω–æ–±–æ–µ—Ü'}
        ];

        // Game State
        let player = null;
        let currentMonster = null;
        let inCombat = false;

        // Initialize
        function initGame() {
            const savedPlayer = localStorage.getItem('dungeonQuestPlayer');
            if (savedPlayer) {
                // Auto-login if player exists
            }
        }

        // Save/Load
        function savePlayer() {
            localStorage.setItem('dungeonQuestPlayer', JSON.stringify(player));
        }

        function loadPlayer(username) {
            const saved = localStorage.getItem('dungeonQuestPlayer');
            if (saved) {
                const data = JSON.parse(saved);
                if (data.username === username) {
                    return data;
                }
            }
            return null;
        }

        // Login
        function login() {
            const username = document.getElementById('username').value.trim();
            if (!username) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞!');
                return;
            }

            player = loadPlayer(username);
            if (!player) {
                // Create new player
                player = {
                    username: username,
                    level: 1,
                    experience: 0,
                    hp: 100,
                    maxHp: 100,
                    strength: 10,
                    defense: 5,
                    agility: 5,
                    gold: 100,
                    weapon: '–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –º–µ—á',
                    armor: '–¢–∫–∞–Ω–µ–≤–∞—è –±—Ä–æ–Ω—è',
                    accessory: null,
                    inventory: {},
                    completedQuests: [],
                    killCount: {}
                };
            }

            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            updateUI();
            loadShop();
            loadQuests();
        }

        // Calculate stats with equipment
        function getStats() {
            let stats = {
                hp: player.hp,
                maxHp: player.maxHp,
                strength: player.strength,
                defense: player.defense,
                agility: player.agility
            };

            [player.weapon, player.armor, player.accessory].forEach(equipName => {
                if (equipName) {
                    const item = ITEMS.find(i => i.name === equipName);
                    if (item) {
                        stats.strength += item.damage || 0;
                        stats.defense += item.defense || 0;
                        stats.agility += item.agility || 0;
                        stats.maxHp += item.hp || 0;
                    }
                }
            });

            return stats;
        }

        // Update UI
        function updateUI() {
            const stats = getStats();
            
            document.getElementById('playerName').textContent = player.username;
            document.getElementById('playerLevel').textContent = player.level;
            document.getElementById('playerGold').textContent = player.gold;
            
            const expNeeded = Math.floor(100 * Math.pow(1.5, player.level - 1));
            document.getElementById('playerExpText').textContent = `${player.experience} / ${expNeeded}`;
            const expPercent = (player.experience / expNeeded) * 100;
            document.getElementById('expBar').style.width = `${Math.min(100, expPercent)}%`;
            document.getElementById('expBar').textContent = `${player.experience} / ${expNeeded}`;
            
            document.getElementById('playerHpText').textContent = `${player.hp} / ${stats.maxHp}`;
            const hpPercent = (player.hp / stats.maxHp) * 100;
            document.getElementById('hpBar').style.width = `${Math.max(0, hpPercent)}%`;
            document.getElementById('hpBar').textContent = `${player.hp} / ${stats.maxHp}`;
            
            document.getElementById('playerStrength').textContent = stats.strength;
            document.getElementById('playerDefense').textContent = stats.defense;
            document.getElementById('playerAgility').textContent = stats.agility;
            
            document.getElementById('equippedWeapon').textContent = player.weapon || '–ù–µ—Ç';
            document.getElementById('equippedArmor').textContent = player.armor || '–ù–µ—Ç';
            document.getElementById('equippedAccessory').textContent = player.accessory || '–ù–µ—Ç';
            
            // Inventory
            const invDiv = document.getElementById('inventoryItems');
            invDiv.innerHTML = '';
            const hasItems = Object.keys(player.inventory).length > 0;
            
            if (hasItems) {
                for (const [item, count] of Object.entries(player.inventory)) {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'inventory-item';
                    const itemData = ITEMS.find(i => i.name === item);
                    if (itemData && itemData.type === 'consumable') {
                        itemDiv.onclick = () => useItem(item);
                        itemDiv.style.cursor = 'pointer';
                    }
                    itemDiv.innerHTML = `
                        <div style="font-size: 13px;">${item}</div>
                        <span class="item-count">x${count}</span>
                    `;
                    invDiv.appendChild(itemDiv);
                }
            } else {
                invDiv.innerHTML = '<div class="empty-state">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
            }
            
            savePlayer();
        }

        // Use consumable item
        function useItem(itemName) {
            const item = ITEMS.find(i => i.name === itemName);
            if (!item || item.type !== 'consumable') return;
            
            if (!player.inventory[itemName] || player.inventory[itemName] <= 0) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç —ç—Ç–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞!');
                return;
            }
            
            const stats = getStats();
            if (player.hp >= stats.maxHp) {
                alert('–£ –≤–∞—Å –ø–æ–ª–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ!');
                return;
            }
            
            player.hp = Math.min(stats.maxHp, player.hp + item.heal);
            player.inventory[itemName]--;
            if (player.inventory[itemName] <= 0) {
                delete player.inventory[itemName];
            }
            
            updateUI();
            alert(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${itemName}\n–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${item.heal} HP`);
        }

        // Start Combat
        function startCombat() {
            if (inCombat) return;
            
            const availableMonsters = MONSTERS.filter(m => 
                m.level >= player.level - 2 && m.level <= player.level + 2
            );
            
            if (availableMonsters.length === 0) {
                currentMonster = MONSTERS[0];
            } else {
                currentMonster = JSON.parse(JSON.stringify(
                    availableMonsters[Math.floor(Math.random() * availableMonsters.length)]
                ));
            }
            
            currentMonster.maxHp = currentMonster.hp;
            inCombat = true;
            
            document.getElementById('combatArea').classList.remove('hidden');
            document.getElementById('monsterName').textContent = currentMonster.name;
            document.getElementById('monsterLevel').textContent = currentMonster.level;
            document.getElementById('monsterStrength').textContent = currentMonster.strength;
            document.getElementById('monsterDefense').textContent = currentMonster.defense;
            updateMonsterHP();
            
            document.getElementById('combatLog').innerHTML = '<div class="log-entry">‚öîÔ∏è –ë–æ–π –Ω–∞—á–∞–ª—Å—è!</div>';
            document.getElementById('rewardDisplay').classList.add('hidden');
        }

        function updateMonsterHP() {
            document.getElementById('monsterHpText').textContent = `${Math.max(0, currentMonster.hp)} / ${currentMonster.maxHp}`;
            const hpPercent = (currentMonster.hp / currentMonster.maxHp) * 100;
            document.getElementById('monsterHpBar').style.width = `${Math.max(0, hpPercent)}%`;
            document.getElementById('monsterHpBar').textContent = `${Math.max(0, currentMonster.hp)} HP`;
        }

        // Attack
        function attack() {
            if (!inCombat) return;
            
            const stats = getStats();
            const logDiv = document.getElementById('combatLog');
            
            // Player attacks
            const playerDmg = Math.max(1, stats.strength + Math.floor(Math.random() * 7) - 3 - currentMonster.defense);
            currentMonster.hp -= playerDmg;
            
            addLog(`üí• –í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${playerDmg} —É—Ä–æ–Ω–∞ ${currentMonster.name}`);
            updateMonsterHP();
            
            // Check monster defeated
            if (currentMonster.hp <= 0) {
                victory();
                return;
            }
            
            // Monster attacks
            const monsterDmg = Math.max(1, currentMonster.strength + Math.floor(Math.random() * 5) - 2 - stats.defense);
            player.hp -= monsterDmg;
            player.hp = Math.max(0, player.hp);
            
            addLog(`üó°Ô∏è ${currentMonster.name} –Ω–∞–Ω–µ—Å –≤–∞–º ${monsterDmg} —É—Ä–æ–Ω–∞`);
            updateUI();
            
            // Check player defeated
            if (player.hp <= 0) {
                defeat();
            }
        }

        function addLog(text) {
            const logDiv = document.getElementById('combatLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = text;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function victory() {
            inCombat = false;
            addLog(`‚úÖ ${currentMonster.name} –ø–æ–≤–µ—Ä–∂–µ–Ω!`);
            
            // Calculate rewards
            const loot = [];
            for (const [itemName, chance] of Object.entries(currentMonster.loot)) {
                if (Math.random() < chance) {
                    loot.push(itemName);
                    player.inventory[itemName] = (player.inventory[itemName] || 0) + 1;
                }
            }
            
            player.experience += currentMonster.exp;
            player.gold += currentMonster.gold;
            
            // Track kills for quests
            player.killCount[currentMonster.name] = (player.killCount[currentMonster.name] || 0) + 1;
            
            // Check level up
            const expNeeded = Math.floor(100 * Math.pow(1.5, player.level - 1));
            let leveledUp = false;
            
            while (player.experience >= expNeeded) {
                player.level++;
                player.experience -= expNeeded;
                player.maxHp += 10;
                player.strength += 2;
                player.defense += 1;
                player.agility += 1;
                player.hp = getStats().maxHp;
                leveledUp = true;
            }
            
            // Show rewards
            const rewardDiv = document.getElementById('rewardDisplay');
            rewardDiv.classList.remove('hidden');
            rewardDiv.innerHTML = `
                <h3>üéâ –ü–æ–±–µ–¥–∞!</h3>
                <div class="reward-item">üí∞ –ó–æ–ª–æ—Ç–æ: +${currentMonster.gold}</div>
                <div class="reward-item">‚≠ê –û–ø—ã—Ç: +${currentMonster.exp}</div>
                ${leveledUp ? `<div class="reward-item" style="color: var(--success); font-weight: bold;">üéä –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å: ${player.level}!</div>` : ''}
                ${loot.length > 0 ? `<div class="reward-item">üéÅ –î–æ–±—ã—á–∞: ${loot.join(', ')}</div>` : ''}
            `;
            
            updateUI();
            loadQuests();
        }

        function defeat() {
            inCombat = false;
            addLog('üíÄ –í—ã –±—ã–ª–∏ –ø–æ–±–µ–∂–¥–µ–Ω—ã!');
            alert('–í—ã –±—ã–ª–∏ –ø–æ–±–µ–∂–¥–µ–Ω—ã! –í–∞—Å –≤—ã–ª–µ—á–∏–ª–∏ –≤ –≥–æ—Ä–æ–¥–µ.');
            player.hp = getStats().maxHp;
            document.getElementById('combatArea').classList.add('hidden');
            updateUI();
        }

        function fleeCombat() {
            inCombat = false;
            currentMonster = null;
            document.getElementById('combatArea').classList.add('hidden');
        }

        // Heal
        function healPlayer() {
            const cost = 20;
            if (player.gold < cost) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!');
                return;
            }
            
            const stats = getStats();
            if (player.hp >= stats.maxHp) {
                alert('–£ –≤–∞—Å –ø–æ–ª–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ!');
                return;
            }
            
            player.gold -= cost;
            player.hp = stats.maxHp;
            updateUI();
            alert(`–í—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –∑–¥–æ—Ä–æ–≤—å–µ –∑–∞ ${cost} –∑–æ–ª–æ—Ç–∞`);
        }

        // Shop
        function loadShop() {
            const shopDiv = document.getElementById('shopItems');
            shopDiv.innerHTML = '';
            
            ITEMS.filter(item => item.type !== 'consumable').forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'shop-item';
                
                const stats = [];
                if (item.damage) stats.push(`‚öîÔ∏è –£—Ä–æ–Ω: +${item.damage}`);
                if (item.defense) stats.push(`üõ°Ô∏è –ó–∞—â–∏—Ç–∞: +${item.defense}`);
                if (item.agility) stats.push(`‚ö° –õ–æ–≤–∫–æ—Å—Ç—å: +${item.agility}`);
                if (item.hp) stats.push(`‚ù§Ô∏è HP: +${item.hp}`);
                
                const canBuy = player.level >= item.level && player.gold >= item.price;
                
                itemDiv.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-stats">${stats.join(' | ')}</div>
                        <div class="item-stats">–¢—Ä–µ–±—É–µ–º—ã–π —É—Ä–æ–≤–µ–Ω—å: ${item.level}</div>
                    </div>
                    <div>
                        ${item.price > 0 ? `<span class="item-price">üí∞ ${item.price}</span>` : ''}
                        <button class="btn btn-secondary btn-small" onclick="buyItem('${item.name}')" ${!canBuy ? 'disabled' : ''}>
                            –ö—É–ø–∏—Ç—å
                        </button>
                    </div>
                `;
                
                shopDiv.appendChild(itemDiv);
            });
        }

        function buyItem(itemName) {
            const item = ITEMS.find(i => i.name === itemName);
            if (!item) return;
            
            if (player.gold < item.price) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!');
                return;
            }
            
            if (player.level < item.level) {
                alert('–í–∞—à —É—Ä–æ–≤–µ–Ω—å —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π!');
                return;
            }
            
            player.gold -= item.price;
            
            // Auto-equip
            if (item.type === 'weapon') player.weapon = item.name;
            else if (item.type === 'armor') player.armor = item.name;
            else if (item.type === 'accessory') player.accessory = item.name;
            
            updateUI();
            loadShop();
            alert(`–ö—É–ø–ª–µ–Ω–æ –∏ —ç–∫–∏–ø–∏—Ä–æ–≤–∞–Ω–æ: ${item.name}`);
        }

        // Quests
        function loadQuests() {
            const questDiv = document.getElementById('questList');
            questDiv.innerHTML = '';
            
            const availableQuests = QUESTS.filter(q => q.level <= player.level);
            
            if (availableQuests.length === 0) {
                questDiv.innerHTML = '<div class="empty-state">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤</div>';
                return;
            }
            
            availableQuests.forEach(quest => {
                const completed = player.completedQuests.includes(quest.id);
                const progress = player.killCount[quest.target] || 0;
                
                const questDiv2 = document.createElement('div');
                questDiv2.className = `quest-item ${completed ? 'completed' : ''}`;
                questDiv2.innerHTML = `
                    <div class="quest-title">${quest.title} ${completed ? '‚úÖ' : ''}</div>
                    <div class="quest-desc">${quest.desc}</div>
                    <div class="quest-desc">–ü—Ä–æ–≥—Ä–µ—Å—Å: ${Math.min(progress, quest.count)}/${quest.count}</div>
                    <div class="quest-reward">–ù–∞–≥—Ä–∞–¥–∞: ${quest.exp} –æ–ø—ã—Ç–∞, ${quest.gold} –∑–æ–ª–æ—Ç–∞${quest.item ? `, ${quest.item}` : ''}</div>
                    ${!completed && progress >= quest.count ? '<button class="btn btn-success btn-small" onclick="completeQuest(' + quest.id + ')" style="margin-top: 10px;">–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É</button>' : ''}
                `;
                questDiv.appendChild(questDiv2);
            });
        }

        function completeQuest(questId) {
            const quest = QUESTS.find(q => q.id === questId);
            if (!quest) return;
            
            const progress = player.killCount[quest.target] || 0;
            if (progress < quest.count) {
                alert('–ö–≤–µ—Å—Ç –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
                return;
            }
            
            if (player.completedQuests.includes(questId)) {
                alert('–ö–≤–µ—Å—Ç —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
                return;
            }
            
            player.completedQuests.push(questId);
            player.experience += quest.exp;
            player.gold += quest.gold;
            
            if (quest.item) {
                player.inventory[quest.item] = (player.inventory[quest.item] || 0) + 1;
            }
            
            // Check level up
            const expNeeded = Math.floor(100 * Math.pow(1.5, player.level - 1));
            if (player.experience >= expNeeded) {
                player.level++;
                player.experience -= expNeeded;
                player.maxHp += 10;
                player.strength += 2;
                player.defense += 1;
                player.agility += 1;
                player.hp = getStats().maxHp;
            }
            
            updateUI();
            loadQuests();
            alert(`–ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!\n+${quest.exp} –æ–ø—ã—Ç–∞\n+${quest.gold} –∑–æ–ª–æ—Ç–∞${quest.item ? '\n+' + quest.item : ''}`);
        }

        // Enter key for login
        document.getElementById('username')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') login();
        });

        // Initialize game
        initGame();
    </script>
</body>
</html>